---
import { cn } from "../../src/tools/cn";
import SidebarElement from "./SidebarElement.astro";
import type { Entry } from "./types";
import config from "virtual:shipyard/config";

interface Props {
  local: Entry | undefined;
  global: Entry;
  brand: string;
}

const { local, global, brand } = Astro.props;

// Only prefix with locale when i18n is configured AND we have a currentLocale from Astro
const currentLocale = Astro.currentLocale || config.defaultLocale;
const withLocale = (path: string) => Astro.currentLocale ? `/${Astro.currentLocale}${path}` : path;
---

<ul class={cn("menu min-h-screen w-56 bg-base-100", { "md:hidden": !local })}>
  <div>
    <a href={withLocale("/")} class="btn btn-ghost mb-2 text-xl">
      {brand}
    </a>
  </div>
  <div class="block md:hidden">
    <li>
      {
        local ? (
          <details>
            <summary>Main menu</summary>
            <SidebarElement entry={global} />
          </details>
        ) : (
          <SidebarElement entry={global} />
        )
      }
    </li>
    <div class={cn("divider my-1 block md:hidden", { hidden: !local })}></div>
  </div>
  {local && <SidebarElement entry={local} />}
</ul>
