---
import { cn } from '../../src/tools/cn'
import LanguageSwitcher from './LanguageSwitcher.astro'
import SidebarElement from './SidebarElement.astro'
import type { Entry } from './types'

interface Props {
  local: Entry | undefined
  global: Entry
  brand: string
}

const { local, global, brand } = Astro.props

const withLocale = (path: string) =>
  Astro.currentLocale ? `/${Astro.currentLocale}${path}` : path
---

<ul class={cn("menu min-h-screen w-56 bg-base-100", { "md:hidden": !local })} data-testid="sidebar-navigation">
  <div>
    <a href={withLocale("/")} class="btn btn-ghost mb-2 text-xl">
      {brand}
    </a>
  </div>
  <div class="block md:hidden" data-testid="sidebar-global-nav">
    <li>
      {
        local ? (
          <details>
            <summary>Main menu</summary>
            <SidebarElement entry={global} />
          </details>
        ) : (
          <SidebarElement entry={global} />
        )
      }
    </li>
    <slot name="sidebarExtra" />
    <LanguageSwitcher variant="list" />
    <div class={cn("divider my-1 block md:hidden", { hidden: !local })}></div>
  </div>
  {local && <div data-testid="sidebar-local-nav"><SidebarElement entry={local} /></div>}
</ul>
