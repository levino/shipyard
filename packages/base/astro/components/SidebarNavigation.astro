---
import { cn } from '../../src/tools/cn'
import LanguageSwitcher from './LanguageSwitcher.astro'
import SidebarElement from './SidebarElement.astro'
import ThemeToggle from './ThemeToggle.astro'
import type { Entry } from './types'

interface Props {
  local: Entry | undefined
  global: Entry
  brand: string
}

const { local, global, brand } = Astro.props

const withLocale = (path: string) =>
  Astro.currentLocale ? `/${Astro.currentLocale}${path}` : path
---

<ul class={cn("menu min-h-full w-56 bg-base-100", { "lg:hidden": !local })} data-testid="sidebar-navigation">
  <div class="max-w-full">
    <a href={withLocale("/")} class="btn btn-ghost mb-2 max-w-full truncate text-lg">
      {brand}
    </a>
  </div>
  <div class="block lg:hidden" data-testid="sidebar-global-nav">
    <li>
      {
        local ? (
          <details>
            <summary>Main menu</summary>
            <SidebarElement entry={global} />
          </details>
        ) : (
          <SidebarElement entry={global} />
        )
      }
    </li>
    <slot name="sidebarExtra" />
    <LanguageSwitcher variant="list" />
    <li class="flex flex-row items-center gap-2 px-4 py-2">
      <span class="text-sm opacity-70">Theme</span>
      <ThemeToggle />
    </li>
    <div class={cn("divider my-1 block lg:hidden", { hidden: !local })}></div>
  </div>
  {local && <div data-testid="sidebar-local-nav"><SidebarElement entry={local} /></div>}
</ul>
