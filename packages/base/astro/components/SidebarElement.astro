---
import { cn } from '../../src/tools/cn'
import type { Entry } from './types'

interface Props {
  entry: Entry
  currentPath?: string
}

const { entry, currentPath = Astro.url.pathname } = Astro.props

// Normalize path by removing trailing slash for comparison
const normalizePath = (path: string) => path.replace(/\/$/, '') || '/'

// Check if entry or any of its children are active
const isActiveOrHasActiveChild = (entryValue: Entry[string]): boolean => {
  if (entryValue.href && normalizePath(entryValue.href) === normalizePath(currentPath))
    return true
  if (entryValue.subEntry) {
    return Object.values(entryValue.subEntry).some(isActiveOrHasActiveChild)
  }
  return false
}
---

{Object.entries(entry).map(([key, entryValue]) => {
  const label = entryValue.label ?? key;
  const isActive = entryValue.href && normalizePath(entryValue.href) === normalizePath(currentPath);
  const hasActiveChild = entryValue.subEntry && Object.values(entryValue.subEntry).some(isActiveOrHasActiveChild);
  return (
    <li class={entryValue.className}>
      {entryValue.href
        ? <a href={entryValue.href} class={cn({ 'bg-base-200/50 font-medium text-primary': isActive })}>{label}</a>
        : <span class='menu-title'>{label}</span>}
      {entryValue.subEntry ? (
        <ul>
          <Astro.self entry={entryValue.subEntry} currentPath={currentPath} />
        </ul>
      ) : null}
    </li>
  )
})}
